<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reconhecimento de Coral</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.9.0"></script>
</head>
<body>
    <h1>Reconhecimento de Coral - Coral Sol e Coral Normal</h1>
    <button type="button" onclick="init()">Iniciar Reconhecimento</button>
    <div id="webcam-container"></div>
    <div id="label-container"></div>

    <script type="text/javascript">
        const modelURL = './js_model/model.json'; // Caminho para o modelo no GitHub Pages
        let model, webcam, labelContainer;

        async function init() {
            try {
                // Carregar o modelo
                model = await tf.loadLayersModel(modelURL);

                // Configurar e iniciar a webcam
                const videoElement = document.createElement('video');
                videoElement.width = 500;
                videoElement.height = 500;
                document.getElementById('webcam-container').appendChild(videoElement);

                webcam = await tf.data.webcam(videoElement);

                // Inicializar área de predição
                labelContainer = document.getElementById('label-container');
                labelContainer.innerHTML = "<div>Classificação: </div><div>Probabilidade: </div>";

                // Iniciar o loop de predição
                await loop();
            } catch (error) {
                console.error("Erro ao inicializar: ", error);
                alert("Erro ao acessar a câmera ou carregar o modelo. Verifique as permissões e o caminho do modelo.");
            }
        }

        async function loop() {
            while (true) {
                const img = await webcam.capture();
                
                // Fazer a predição e obter os resultados
                const prediction = model.predict(img.expandDims(0));
                const data = prediction.dataSync();
                
                // Atualizar as classificações no HTML
                const classes = ["Coral Sol", "Coral Normal"];
                labelContainer.children[0].innerHTML = `Classificação: ${data[0] > data[1] ? classes[0] : classes[1]}`;
                labelContainer.children[1].innerHTML = `Probabilidade: ${(data[0] > data[1] ? data[0] : data[1]).toFixed(2)}`;

                img.dispose();
                await tf.nextFrame(); // Controlar o loop para melhorar desempenho
            }
        }
    </script>
</body>
</html>
